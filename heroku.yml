setup:
  addons:
    - plan: heroku-postgresql:essential-0
    - plan: heroku-redis:mini
  config:
    JWT_SECRET: change-me-in-production
    LOG_LEVEL: INFO

build:
  docker:
    web: packages/backend/Dockerfile
    frontend:
      dockerfile: app/Dockerfile
      args:
        VITE_API_URL: https://${HEROKU_APP_NAME}.herokuapp.com

run:
  web: sh -c "python -m flask --app wsgi:app init-db && gunicorn -w 2 -k gthread --timeout 120 -b 0.0.0.0:$PORT wsgi:app"
